(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[565],{3281:function(e,t,r){Promise.resolve().then(r.bind(r,8606))},7138:function(e,t,r){"use strict";r.d(t,{default:function(){return o.a}});var n=r(231),o=r.n(n)},8606:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c}});var n=r(7437),o=r(7138),s=r(2265),i=r(1270),l=r(1435),a=r(6463),u=r(9391);function c(){let{cartItems:e,removeFromCart:t,clearCart:r}=(0,l.j)(),{userInfo:c}=(0,i.a)(),d=(0,a.useRouter)(),[p,h]=(0,s.useState)(""),[f,m]=(0,s.useState)(!1),g=e.reduce((e,t)=>e+t.price*t.quantity,0),x=async()=>{if(!c){d.push("/login?redirect=/cart");return}m(!0),h("");try{let t=e.map(e=>({productId:e.productId,quantity:e.quantity}));await u.Z.post("/orders",{cartItems:t}),r(),d.push("/orders")}catch(e){var t,n;console.log("err: ",e),h((null===(n=e.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.message)||"Checkout failed. Please try again.")}finally{m(!1)}};return(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{children:"Shopping Cart"}),0===e.length?(0,n.jsxs)("p",{children:["Your cart is empty. ",(0,n.jsx)(o.default,{href:"/",style:{color:"#0070f3"},children:"Go Shopping"})]}):(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:"2rem"},children:[(0,n.jsx)("div",{children:e.map(e=>(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"1rem",borderBottom:"1px solid #eee",paddingBottom:"1rem"},children:[(0,n.jsx)("img",{src:e.imageUrl||"https://via.placeholder.com/100",alt:e.name,style:{width:"100px",height:"100px",objectFit:"cover",marginRight:"1rem"}}),(0,n.jsxs)("div",{style:{flexGrow:1},children:[(0,n.jsx)("p",{style:{margin:0,fontWeight:"bold"},children:e.name}),(0,n.jsxs)("p",{style:{margin:"0.25rem 0"},children:["Quantity: ",e.quantity]}),(0,n.jsxs)("p",{style:{margin:0},children:["$",e.price.toFixed(2)]})]}),(0,n.jsx)("button",{onClick:()=>t(e.productId),style:{background:"none",border:"none",color:"red",cursor:"pointer"},children:"Remove"})]},e.productId))}),(0,n.jsxs)("div",{style:{background:"#f9f9f9",padding:"1.5rem",borderRadius:"8px"},children:[(0,n.jsx)("h2",{children:"Order Summary"}),(0,n.jsxs)("p",{style:{display:"flex",justifyContent:"space-between"},children:[(0,n.jsx)("span",{children:"Subtotal"}),(0,n.jsxs)("strong",{children:["$",g.toFixed(2)]})]}),(0,n.jsx)("button",{onClick:x,disabled:f,style:{width:"100%",marginTop:"1rem"},children:f?"Processing...":"Proceed to Checkout"}),p&&(0,n.jsx)("p",{style:{color:"red",marginTop:"1rem"},children:p})]})]})]})}},1270:function(e,t,r){"use strict";r.d(t,{H:function(){return l},a:function(){return a}});var n=r(7437),o=r(2265),s=r(6463);let i=(0,o.createContext)(null),l=e=>{let{children:t}=e,[r,l]=(0,o.useState)(null),a=(0,s.useRouter)();return(0,o.useEffect)(()=>{let e=localStorage.getItem("userInfo");e&&l(JSON.parse(e))},[]),(0,n.jsx)(i.Provider,{value:{userInfo:r,login:e=>{localStorage.setItem("userInfo",JSON.stringify(e)),l(e),a.push("/")},logout:()=>{localStorage.removeItem("userInfo"),l(null),a.push("/login")}},children:t})},a=()=>{let e=(0,o.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},1435:function(e,t,r){"use strict";r.d(t,{Z:function(){return i},j:function(){return l}});var n=r(7437),o=r(2265);let s=(0,o.createContext)(null),i=e=>{let{children:t}=e,[r,i]=(0,o.useState)([]);return(0,o.useEffect)(()=>{let e=localStorage.getItem("cartItems");e&&i(JSON.parse(e))},[]),(0,o.useEffect)(()=>{localStorage.setItem("cartItems",JSON.stringify(r))},[r]),(0,n.jsx)(s.Provider,{value:{cartItems:r,addToCart:e=>{i(t=>t.find(t=>t.productId===e.productId)?t.map(t=>t.productId===e.productId?{...t,quantity:t.quantity+1}:t):[...t,{...e,quantity:1}])},removeFromCart:e=>{i(t=>t.filter(t=>t.productId!==e))},clearCart:()=>{i([]),localStorage.removeItem("cartItems")}},children:t})},l=()=>{let e=(0,o.useContext)(s);if(!e)throw Error("useCart must be used within a CartProvider");return e}},9391:function(e,t,r){"use strict";let n=r(8472).Z.create({baseURL:"http://localhost:5001/api"});n.interceptors.request.use(e=>{{let t=localStorage.getItem("userInfo");if(t){let{token:r}=JSON.parse(t);r&&(e.headers.Authorization="Bearer ".concat(r))}}return e}),t.Z=n}},function(e){e.O(0,[236,231,971,23,744],function(){return e(e.s=3281)}),_N_E=e.O()}]);